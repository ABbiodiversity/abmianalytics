---
title: 'Appendix: Species Results'
author: "Peter Solymos, Judith D. Toms, Steven M. Matsuoka, Steven G. Cumming, Nicole K. S. Barker, Wayne E. Thogmartin, Diana Stralberg, Andrew D. Crosby, Francisco V. DÃ©nes, Samuel Hache, C. Lisa Mahon, Fiona K. A. Schmiegelow, and Erin M. Bayne"
date: "Version: `r format(Sys.time(), '%Y-%m-%d')`"
output:
  pdf_document:
    toc: false
    toc_depth: 3
    number_sections: false
documentclass: report
fontsize: 10pt
classoption: letterpaper
urlcolor: blue
header-includes:
  - \usepackage{float}
---

```{r preamble,include=FALSE}
library(knitr)
opts_chunk$set(cache=FALSE, echo=FALSE, message=FALSE, warning=FALSE, fig.pos="H", fig.align="center")
## final subset of species based on all the data
SPP <- c("ALFL", "AMCR", "AMGO", "AMRE", "AMRO", "ATTW", "BAOR", "BARS",
    "BAWW", "BBMA", "BBWA", "BBWO", "BCCH", "BHCO", "BHVI", "BLJA",
    "BLPW", "BOCH", "BRBL", "BRCR", "BTNW", "CAWA", "CCSP", "CEDW",
    "CHSP", "CMWA", "CONW", "CORA", "COYE", "DEJU", "DOWO", "EAKI",
    "EVGR", "FOSP", "GCKI", "GRAJ", "GRCA", "HAWO", "HETH", "HOLA",
    "HOWR", "LCSP", "LEFL", "LISP", "MAWA", "MODO", "MOWA", "NOFL",
    "NOWA", "OCWA", "OSFL", "OVEN", "PAWA", "PHVI", "PISI", "PIWO",
    "PUFI", "RBGR", "RBNU", "RCKI", "REVI", "RUBL", "RWBL", "SAVS",
    "SOSP", "SWSP", "SWTH", "TEWA", "TRES", "VATH", "VEER", "VESP",
    "WAVI", "WBNU", "WCSP", "WETA", "WEWP", "WIWA", "WIWR", "WTSP",
    "WWCR", "YBFL", "YBSA", "YEWA", "YRWA")
## final subset based on 2006-2015 daya
SPP <- SPP[!(SPP %in% c("BBWO", "PISI", "WBNU", "ATTW"))]

TAB <- read.csv("d:/abmi/AB_data_v2018/data/analysis/birds/bcr6/pifpix-v3-all-results.csv")
rownames(TAB) <- TAB$Code

#pop <- read.csv("~/GoogleWork/bam/PIF-AB/draft2/Table1-estimates.csv")
pop <- read.csv("d:/abmi/AB_data_v2018/data/analysis/birds/bcr6/pifpix-v3-2006-2015-results.csv")
rownames(pop) <- pop$Code

Dall <- read.csv("d:/abmi/AB_data_v2018/data/analysis/birds/bcr6/pifpix-v3-densities-2006-2015.csv")
rownames(Dall) <- Dall[,1]
Dall[,1] <- NULL
DD <- as.matrix(t(Dall[,-(1:2)]))
NN <- t(t(DD) * Dall$Ahab)
NN <- t(NN / rowSums(NN))
```

We provide the following information for each of the 81 species:

- pixel (PIX) and PIF based population size estimates with 95% confidence intervals (millions of individuals),
- the metrics used for the calculations and AUC as a measure of classification accuracy,
- average density in each land cover type, and by age category for forest stands (bar vs. line indicates fire vs. harvest originated stands),
- maps: detections aggregated in 10 km x 10 km units (full study area), mean density and 95% confidence interval range as a measure of uncertainty (BCR 6 prediction area),
- land cover level average densities and percent of the total population found in each land cover type within the BCR 6 prediction area.

```{r results='asis'}
cn1 <- c("Npix", "Npix95lower", "Npix95upper", "Npif", "Npif95lower", "Npif95upper")
cn2 <- c("Y1", "Y0", "TimeAdj", "p3", "MDD", "EDR", "AUC")
for (spp in SPP) {
  v <- as.list(pop[spp,])
  cat("##", paste0(v$CommonName, " (_", v$ScientificName, "_)"))
  cat(kable(round(pop[spp,cn1],4), format="latex", row.names = FALSE))
  cat("\n\n")
  cat(kable(round(pop[spp,cn2],4), format="latex", row.names = FALSE))
  cat("\n\n")
  cat("![](d:/abmi/AB_data_v2018/data/analysis/birds/bcr6/mapsMedian/", spp, "-habitats.png)", 
    sep="")
  cat("\n\n")
  cat("![](d:/abmi/AB_data_v2018/data/analysis/birds/bcr6/mapsSubsetFinal/", spp, ".png)", 
    sep="")
  cat("\n\n")
  cat(kable(t(data.frame(Density=round(DD[spp,], 4), Percent=round(100*NN[,spp]/sum(NN[,spp]), 2)))[,1:10],
    format="latex"))
  cat(kable(t(data.frame(Density=round(DD[spp,], 4), Percent=round(100*NN[,spp]/sum(NN[,spp]), 2)))[,11:18],
    format="latex"))
}
```

